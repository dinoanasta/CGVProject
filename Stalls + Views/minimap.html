<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <title>Minimap</title>

    <style>
        body
        {
            font-family: Monospace;
            font-weight: bold;
            background-color: #ccccff;
            margin: 0px;
            overflow: hidden;
        }

    </style>
</head>
<body>

<div id = "myCanvas" style="position: absolute; left:0px; top:0px"></div>
<div id = "miniCanvas" style="position: absolute; left:100px; top:100px; width:320px; height:240px;"></div>

<script src = "../js/three.js"></script>
<script src="../js/Detector.js"></script>

<script>

    // SCENE
    var scene = new THREE.Scene();
    // CAMERA
    var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
    var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;

    // perspective cameras
     var perspectiveCamera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
    perspectiveCamera.position.set(0,200,550);
    perspectiveCamera.lookAt(scene.position);
    scene.add(perspectiveCamera);

    // orthographic cameras
    var mapCamera = new THREE.OrthographicCamera(
        window.innerWidth / -2,		// Left
        window.innerWidth / 2,		// Right
        window.innerHeight / 2,		// Top
        window.innerHeight / -2,	// Bottom
        -5000,            			// Near
        10000 );           			// Far
    mapCamera.up = new THREE.Vector3(0,0,-1);
    mapCamera.lookAt( new THREE.Vector3(0,-1,0) );
    scene.add(mapCamera);

    // RENDERER
    var renderer, container;

    if ( Detector.webgl )
        renderer = new THREE.WebGLRenderer( {antialias:true} );
    else
        renderer = new THREE.CanvasRenderer();
    renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
    container = document.getElementById( 'myCanvas' );
    container.appendChild( renderer.domElement );

    // LIGHT
    var light = new THREE.PointLight(0xffffff);
    light.position.set(0,250,0);
    scene.add(light);

    var ambientlight = new THREE.AmbientLight(0x111111);
    scene.add( ambientlight );

    // OBJECTS
    var geometry1 = new THREE.BoxBufferGeometry(100,100,100);
    var geometry2 = new THREE.PlaneBufferGeometry(1000,1000);
    var material1 = new THREE.MeshNormalMaterial();
    var material2 = new THREE.MeshBasicMaterial({ color : 'gray', side : THREE.DoubleSide})

    var box = new THREE.Mesh(geometry1,material1);
    var plane = new THREE.Mesh(geometry2,material2);

    plane.position.y = -100;
    plane.rotation.x = Math.PI/2;

    scene.add(plane);
    scene.add(box);

    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.setClearColor( 0x000000, 1 );
    renderer.autoClear = false;
    animate();

    function animate()
    {

        requestAnimationFrame( animate );

        render();
        //update();
    }

    function render()
    {
        var w = window.innerWidth, h = window.innerHeight;

        box.rotation.y += 0.01;


        // setViewport parameters:
        //  lower_left_x, lower_left_y, viewport_width, viewport_height
        renderer.setViewport( 0, 0, w, h );
        renderer.clear();

        // full display
        // renderer.setViewport( 0, 0, SCREEN_WIDTH - 2, 0.5 * SCREEN_HEIGHT - 2 );
        renderer.render( scene, perspectiveCamera );



        // minimap (overhead orthogonal camera)
        //  lower_left_x, lower_left_y, viewport_width, viewport_height
        var mapWidth = 600, mapHeight = 250;
        renderer.setViewport( -80, h - mapHeight -20, mapWidth, mapHeight );
        renderer.render( scene, mapCamera );


    }


</script>



</body>
</html>